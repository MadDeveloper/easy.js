#!/usr/bin/env node

var execsql     = require( 'execsql' );
var config      = require( __dirname + '/../../config/config' );
var dbConfig    = {
	host: config.database.connection.host,
	user: config.database.connection.user,
	password: config.database.connection.password
};

var Message 			= require( __dirname + '/../../vendor/easy/Message' )();
var titleError			= "Error when importing database";
var consequenceError	= "Importation aborted.";

function raiseError( err ) {
	Message.error({
		title: titleError,
		message: err,
		consequence: consequenceError,
		exit: 0
	});
}

var sql         = 'use ' + config.database.connection.database + ';';
var sqlFile     = __dirname + '/../../config/database/' + config.database.connection.database + '.sql';

execsql.config( dbConfig )
	.exec( sql, function( err, results ) {
        if ( err ) {
            raiseError( err );
        }
    })
	.execFile( sqlFile, function( err, results ) {
        if ( err ) {
            raiseError( err );
        } else {
			Message.success( "Database imported.", true );
        }
        process.exit();
	});
